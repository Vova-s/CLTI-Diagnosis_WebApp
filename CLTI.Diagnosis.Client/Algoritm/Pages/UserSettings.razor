@page "/Pages/UserSettings"
@rendermode InteractiveServer

@using CLTI.Diagnosis.Client.Components
@using CLTI.Diagnosis.Client.Shared
@using CLTI.Diagnosis.Client.Services

@inject IJSRuntime JS
@inject NavigationManager NavigationManager
@inject IUserClientService UserService

<div class="page-container">
    <NavMenuHome />

    <div class="main-content">
        <!-- Title -->
        <div class="title">Налаштування профілю</div>

        @if (!string.IsNullOrEmpty(successMessage))
        {
            <Message Text="@successMessage" State="success" Theme="light" />
        }

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <Message Text="@errorMessage" State="error" Theme="light" />
        }

        <div class="frame-parent">
            <!-- User Info Fields -->
            <div class="parent">
                <div class="e-mail">Ім'я користувача</div>
                <TextInput @bind-Value="firstName" Placeholder="Приклад імені" Theme="light" State="default" />
            </div>

            <div class="parent">
                <div class="e-mail">Прізвище користувача</div>
                <TextInput @bind-Value="lastName" Placeholder="Приклад прізвища" Theme="light" State="default" />
            </div>

            <div class="parent">
                <div class="e-mail">E-mail користувача</div>
                <TextInput @bind-Value="email" Placeholder="user@example.com" Theme="light" State="default" />
            </div>

            <!-- Update Profile Button -->
            <div class="button-group">
                <Button Label="@(isUpdating ? "Збереження..." : "Зберегти зміни")"
                        Variant="@(isUpdating ? "disabled" : "active")"
                        OnClick="UpdateProfile"
                        Disabled="@isUpdating" />
            </div>

            <!-- Password Change Section -->
            <div class="password-section">
                <div class="parent">
                    <div class="e-mail">Старий пароль</div>
                    <TextInput @bind-Value="oldPassword"
                               Placeholder="Введіть старий пароль"
                               Theme="light"
                               State="default"
                               Type="password" />
                </div>

                <div class="parent">
                    <div class="e-mail">Новий пароль</div>
                    <TextInput @bind-Value="newPassword"
                               Placeholder="Введіть новий пароль"
                               Theme="light"
                               State="default"
                               Type="password" />
                </div>

                <div class="parent">
                    <div class="e-mail">Підтвердіть новий пароль</div>
                    <TextInput @bind-Value="confirmPassword"
                               Placeholder="Підтвердіть новий пароль"
                               Theme="light"
                               State="default"
                               Type="password" />
                </div>

                <div class="button-group">
                    <Button Label="@(isChangingPassword ? "Змінюємо..." : "Змінити пароль")"
                            Variant="@(isChangingPassword ? "disabled" : "active")"
                            OnClick="ChangePassword"
                            Disabled="@isChangingPassword" />
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="danger-zone">
                <div class="danger-title">Небезпечна зона</div>
                <div class="parent">
                    <div class="e-mail">Підтвердіть пароль для видалення</div>
                    <TextInput @bind-Value="deletePassword"
                               Placeholder="Введіть пароль для підтвердження"
                               Theme="light"
                               State="default"
                               Type="password" />
                </div>

                <div class="button-group">
                    <Button Label="@(isDeleting ? "Видаляємо..." : "Видалити користувача")"
                            Variant="@(isDeleting ? "disabled" : "active")"
                            Color="#ff3b6b"
                            OnClick="DeleteUser"
                            Disabled="@isDeleting" />
                </div>
            </div>

            <!-- Back Button -->
            <a href="/" class="back-wrapper">
                <Button Label="Назад" Variant="active" Position="fixed" Bottom="24px" Right="24px" />
            </a>
        </div>
    </div>
</div>
